<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Jens Daniel Müller" />


<title>NCP reconstruction</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BloomSail</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data base
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="nomenclature.html">Nomenclature</a>
    </li>
    <li>
      <a href="parameterization.html">Parameterization</a>
    </li>
    <li>
      <a href="read-in.html">Read-in</a>
    </li>
    <li>
      <a href="merging_interpolation.html">Merging and interpolation</a>
    </li>
  </ul>
</li>
<li>
  <a href="response_time.html">Response time</a>
</li>
<li>
  <a href="NCP_best_guess.html">NCP best guess</a>
</li>
<li>
  <a href="Phytoplankton.html">Phytoplankton</a>
</li>
<li>
  <a href="NCP_reconstruction.html">NCP reconstruction</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jens-daniel-mueller/BloomSail">
    <span class="fas fa-github"></span>
     
    Source code
  </a>
</li>
<li>
  <a href="https://jens-daniel-mueller.github.io/">
    <span class="fas fa-home"></span>
     
    Jens' homepage
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">NCP reconstruction</h1>
<h4 class="author">Jens Daniel Müller</h4>
<h4 class="date">30 March, 2021</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2021-03-30
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>BloomSail/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20191021code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20191021)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20191021code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20191021)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomjensdanielmuellerBloomSailtree23acb8c55a2ad20ad351d849cdce800bcf48ddeetargetblank23acb8ca"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/jens-daniel-mueller/BloomSail/tree/23acb8c55a2ad20ad351d849cdce800bcf48ddee" target="_blank">23acb8c</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomjensdanielmuellerBloomSailtree23acb8c55a2ad20ad351d849cdce800bcf48ddeetargetblank23acb8ca" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/jens-daniel-mueller/BloomSail/tree/23acb8c55a2ad20ad351d849cdce800bcf48ddee" target="_blank">23acb8c</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    data/

Untracked files:
    Untracked:  data_os-2020-120_submission.zip
    Untracked:  output/Plots/Figures_publication/.tmp.drivedownload/

Unstaged changes:
    Modified:   output/Plots/Figures_publication/Appendix/Fig_B1.pdf
    Modified:   output/Plots/Figures_publication/Appendix/Fig_C1.pdf
    Modified:   output/Plots/Figures_publication/Appendix/Fig_C2.pdf
    Modified:   output/Plots/Figures_publication/Appendix/Fig_C3.pdf
    Modified:   output/Plots/Figures_publication/Article/Fig_1.pdf
    Modified:   output/Plots/Figures_publication/Article/Fig_2.pdf
    Modified:   output/Plots/Figures_publication/Article/Fig_3.pdf
    Modified:   output/Plots/Figures_publication/Article/Fig_4.pdf
    Modified:   output/Plots/Figures_publication/Article/Fig_5.pdf
    Modified:   output/Plots/Figures_publication/Article/Fig_5.png

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/NCP_reconstruction.Rmd</code>) and HTML (<code>docs/NCP_reconstruction.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/23acb8c55a2ad20ad351d849cdce800bcf48ddee/analysis/NCP_reconstruction.Rmd" target="_blank">23acb8c</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-03-30
</td>
<td>
revised figure according to RC1
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/16c93d2b6b946bf4c8ff7eb805a4412a1f1a7f63/docs/NCP_reconstruction.html" target="_blank">16c93d2</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-03-30
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/7ba53a11af1f2683c81364a7776caf17a9a41db9/analysis/NCP_reconstruction.Rmd" target="_blank">7ba53a1</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-03-30
</td>
<td>
revised figure according to RC1
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/5f4fb9a61defc551665c0bf064174f4f813e2b8f/docs/NCP_reconstruction.html" target="_blank">5f4fb9a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-20
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/031f46a12f8c2cb88527c7d264f4b35fe63c7b5d/analysis/NCP_reconstruction.Rmd" target="_blank">031f46a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-20
</td>
<td>
rerun with early exclusion of negative pCO2
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/516b294f11a1169266d354095d431bb45242d53d/docs/NCP_reconstruction.html" target="_blank">516b294</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/233bbc16d88a38e8d6585584768b86c8acfd5d4e/analysis/NCP_reconstruction.Rmd" target="_blank">233bbc1</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
rerun all with empty folders
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/184f00b36b6ee9d282bd85b0d2558fdf473d6316/docs/NCP_reconstruction.html" target="_blank">184f00b</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/955ac1de960780e2310e919552b3ce19329685c3/analysis/NCP_reconstruction.Rmd" target="_blank">955ac1d</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/43f9d47137d6bc9487a8ffb4016386d46d269144/docs/NCP_reconstruction.html" target="_blank">43f9d47</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/54ddb867d1fbd52a82879857ddb5b8f08b03c57a/analysis/NCP_reconstruction.Rmd" target="_blank">54ddb86</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/3d08cdad926ee8878280a92372842a92b2bbf1d3/docs/NCP_reconstruction.html" target="_blank">3d08cda</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/c909ee0946f5856ddfd55ce67bd0bdd4e220bd8e/analysis/NCP_reconstruction.Rmd" target="_blank">c909ee0</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/67dd4d71038d47ca7e16246170a5014d6f825583/docs/NCP_reconstruction.html" target="_blank">67dd4d7</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/cc7316fe5c110a0124ed3359262d9938fa5a32e4/analysis/NCP_reconstruction.Rmd" target="_blank">cc7316f</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/7014ec6f039697bbaae0fb3d665d6c2feaecb4db/docs/NCP_reconstruction.html" target="_blank">7014ec6</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/c8328699aad58943843fa411ebf3e4a6866a312b/analysis/NCP_reconstruction.Rmd" target="_blank">c832869</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/3e9465696553c8ef5a1b5310b88c17f4a7cd4838/docs/NCP_reconstruction.html" target="_blank">3e94656</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/93a094cfa9be7d2067f8a6d090d88e057a6b8ad2/analysis/NCP_reconstruction.Rmd" target="_blank">93a094c</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-18
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/189f202b6537b97b8d34e593af02ec830643c9d9/docs/NCP_reconstruction.html" target="_blank">189f202</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-16
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/06d5293b859cade7809fd080ce7037b0e829cc3e/analysis/NCP_reconstruction.Rmd" target="_blank">06d5293</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-16
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/0af0021dba885d69325df777722572e8d796e85b/docs/NCP_reconstruction.html" target="_blank">0af0021</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-15
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/4878a06c0d66f31fe2e968d3c6fe33630fd2ef67/analysis/NCP_reconstruction.Rmd" target="_blank">4878a06</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-15
</td>
<td>
cleaning
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/70a8950dc9ee4a6951fd5a886161c649c1c0c332/docs/NCP_reconstruction.html" target="_blank">70a8950</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-11
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/4bdeb1f43d7840fe02617205e7806ff25f7951e3/analysis/NCP_reconstruction.Rmd" target="_blank">4bdeb1f</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-11
</td>
<td>
rerun all with empty folders
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/80517981c8fb9a3403c9ab3773f8a4fc2acf17d5/docs/NCP_reconstruction.html" target="_blank">8051798</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-10
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/9477a183c77b2044ff45e994e1ef8889368f4154/analysis/NCP_reconstruction.Rmd" target="_blank">9477a18</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-10
</td>
<td>
rerun all with empty folders
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/b70ce3ac2e0c676956ec3e72df0b99c2d621d756/docs/NCP_reconstruction.html" target="_blank">b70ce3a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-04
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/f8ff3d778d9a28b210b20c905e9950037e424213/analysis/NCP_reconstruction.Rmd" target="_blank">f8ff3d7</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-04
</td>
<td>
resized figures
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/2394871299bb7dbb7754153c0eae34cf20161db9/docs/NCP_reconstruction.html" target="_blank">2394871</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-03
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/6747fd93cc2830bed00d7bff091640f19953ccbc/analysis/NCP_reconstruction.Rmd" target="_blank">6747fd9</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-03
</td>
<td>
resized figures
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/d6c739533e2cc919cd02882400a70db64d049dfa/docs/NCP_reconstruction.html" target="_blank">d6c7395</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-02
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/4de153fec5d85be9ddf167c0f96ed3badc0ce6af/analysis/NCP_reconstruction.Rmd" target="_blank">4de153f</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-02-02
</td>
<td>
renamed figures
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/289b763adf7e71156fbbf1b60f55295b75b893d0/docs/NCP_reconstruction.html" target="_blank">289b763</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-30
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/b470c95d21940c43c2b6e775e8c2722d7f6ca7a8/analysis/NCP_reconstruction.Rmd" target="_blank">b470c95</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-30
</td>
<td>
resized figures
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/6adb9abdb72ea021ed9e2686e901f4c85f7d9e6f/docs/NCP_reconstruction.html" target="_blank">6adb9ab</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-29
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/54ec4b0ddee8c4213cf3e650ed0d9fec02351752/analysis/NCP_reconstruction.Rmd" target="_blank">54ec4b0</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-29
</td>
<td>
renamed appendix figures
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/2677b390fbf3b319c36bc69643fbed4ee25ca812/docs/NCP_reconstruction.html" target="_blank">2677b39</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-28
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/3eae87b95414702fb00c65d9207b3cccbc710327/analysis/NCP_reconstruction.Rmd" target="_blank">3eae87b</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-28
</td>
<td>
modified figs
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/c5fc34c79baf7b0f01d9f326f0d22514b82c447e/docs/NCP_reconstruction.html" target="_blank">c5fc34c</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-22
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/f656a730e27fc19d0287bd9363990fd9d3157c46/analysis/NCP_reconstruction.Rmd" target="_blank">f656a73</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-22
</td>
<td>
all figs revised
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/a7950fdc0cb7dcefd4bcf9974921d704939c59eb/docs/NCP_reconstruction.html" target="_blank">a7950fd</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-22
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/88fcb0042ed7a6165f703ef5b56cec07d4f69698/analysis/NCP_reconstruction.Rmd" target="_blank">88fcb00</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-22
</td>
<td>
modified figs
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/cde4f1d49041c50932173b6b944d8023de9af704/docs/NCP_reconstruction.html" target="_blank">cde4f1d</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/7cd025c313458acfe2f7487ff5446379b0a8751d/analysis/NCP_reconstruction.Rmd" target="_blank">7cd025c</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-08
</td>
<td>
modified figs
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/e55d103f77f748d89ac8d7e73deb7cbc81efca11/docs/NCP_reconstruction.html" target="_blank">e55d103</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/f31d3e29ccd4abfcbc9438e7a4897bfc34beb085/analysis/NCP_reconstruction.Rmd" target="_blank">f31d3e2</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-05
</td>
<td>
revised figure 4 and 6
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/0bc930acf2a9d2602e81a48a148866ae578e56fd/docs/NCP_reconstruction.html" target="_blank">0bc930a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/1fb97c7a708f4c0c13d241cde3378dc18d526568/analysis/NCP_reconstruction.Rmd" target="_blank">1fb97c7</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-05
</td>
<td>
revised figure 6
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/42772350da587eaa73fdee8fcfe6ba35d9ff90e9/docs/NCP_reconstruction.html" target="_blank">4277235</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-05
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/58c16378a31941bfe3de06b3e62262333be666cb/analysis/NCP_reconstruction.Rmd" target="_blank">58c1637</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2021-01-05
</td>
<td>
new Fig_AX names, A5 added
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/2a105b249b677ced5573b34ebb8987f60266873a/docs/NCP_reconstruction.html" target="_blank">2a105b2</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-11-04
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/2c4509a397f726dad321b73ed6ed50a6206a9853/analysis/NCP_reconstruction.Rmd" target="_blank">2c4509a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-11-04
</td>
<td>
added panel annotation
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/7e29c30dea0e5d6ffa9de5847c5eedaa887e157e/docs/NCP_reconstruction.html" target="_blank">7e29c30</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-11-02
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/7e5a700c87b0568c3f77fcc74d9e70a711d358a8/analysis/NCP_reconstruction.Rmd" target="_blank">7e5a700</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-11-02
</td>
<td>
renamed and revised figures for publication
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/61753efaf1ef3a00e38eff44fd375bff7cfa9912/docs/NCP_reconstruction.html" target="_blank">61753ef</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-30
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/0628954895592d795683792e2c7274103f9bef45/analysis/NCP_reconstruction.Rmd" target="_blank">0628954</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-30
</td>
<td>
renamed plot output
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/838a9c3816d016a3a1fb3fcf15de3975d99e28bf/docs/NCP_reconstruction.html" target="_blank">838a9c3</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-30
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/37582a4113fe570d66fb17857272247e4405af16/analysis/NCP_reconstruction.Rmd" target="_blank">37582a4</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-30
</td>
<td>
updated plot
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/bef182de2c0a07fe93777a489c009d735910da98/docs/NCP_reconstruction.html" target="_blank">bef182d</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-30
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/0b9ca4794b5b45255a5cde5a0ebd316688c32407/analysis/NCP_reconstruction.Rmd" target="_blank">0b9ca47</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-30
</td>
<td>
updated plot
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/9a3f42a850f89b69d48ccdbb71e801cf70fa5ec9/docs/NCP_reconstruction.html" target="_blank">9a3f42a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-24
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/dd86a7092b0500aff7bee053947aad8046eb422f/docs/NCP_reconstruction.html" target="_blank">dd86a70</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/0711e3e6338f5c9eca813b84603806bb0daa1f50/analysis/NCP_reconstruction.Rmd" target="_blank">0711e3e</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-21
</td>
<td>
display MLD mean and sd values
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/05248bf3c35f620221de7b851679658ebc844f6c/docs/NCP_reconstruction.html" target="_blank">05248bf</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-20
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/1c4fe8e5e6726ecd47ca8fea11392f50b8fa48e7/docs/NCP_reconstruction.html" target="_blank">1c4fe8e</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-20
</td>
<td>
table with time series in depth intervals added
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/6896725c5c1e82dac9b0e7069def116a78d551ea/docs/NCP_reconstruction.html" target="_blank">6896725</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-01
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/9f66019ad31f167a7532af645cd9258832d27912/docs/NCP_reconstruction.html" target="_blank">9f66019</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-10-01
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/27c5431f0b1e48188833b066c99d9967186bca44/docs/NCP_reconstruction.html" target="_blank">27c5431</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-09-29
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/2e0f90227dc18aeb856500708e51194fad5495a1/analysis/NCP_reconstruction.Rmd" target="_blank">2e0f902</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-09-29
</td>
<td>
all parameters separate, rebuild
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/1d01685dcb433a0840f5f3418d9aa5e5383ae2e9/docs/NCP_reconstruction.html" target="_blank">1d01685</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-09-28
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/12789001fbbac96e17db5d18b53825b1d13539c8/docs/NCP_reconstruction.html" target="_blank">1278900</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-09-25
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/904f0f7018fb3a343a6b8315520625c8d1c05951/docs/NCP_reconstruction.html" target="_blank">904f0f7</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-09-23
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/66bf52a81e4a228f752cb37b298684cb292e2158/docs/NCP_reconstruction.html" target="_blank">66bf52a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-09-23
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/0c8eed67f18458d0410451d5fea94ea20404592e/analysis/NCP_reconstruction.Rmd" target="_blank">0c8eed6</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-09-23
</td>
<td>
included postprocessed cleaned data
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/e4797a277b856244d9888bd6b26f1f0d570c1b29/docs/NCP_reconstruction.html" target="_blank">e4797a2</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-07-01
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/857208b9e951dea10fb480977fe4b52fba0d7309/analysis/NCP_reconstruction.Rmd" target="_blank">857208b</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-07-01
</td>
<td>
update NCP recon figure
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/c919fb743c6cae42f04422da1cdbb7655aa112fc/docs/NCP_reconstruction.html" target="_blank">c919fb7</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-06-29
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/1461cb6d5fb3802d6d60858e4d204f6bc685b04c/analysis/NCP_reconstruction.Rmd" target="_blank">1461cb6</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-06-29
</td>
<td>
Fig update for talk
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/603af233fbc8978c166eb15a60e27c4a5efe6300/docs/NCP_reconstruction.html" target="_blank">603af23</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/3414c23db3621485a54d4710f80468562c0c7cff/docs/NCP_reconstruction.html" target="_blank">3414c23</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/9eb7215120b5a7bd775221767ca7f1a47e00b62f/docs/NCP_reconstruction.html" target="_blank">9eb7215</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/80a7e08c744bc368f21eb42f4e4e26f7f84ec9bc/analysis/NCP_reconstruction.Rmd" target="_blank">80a7e08</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
Removed separate BloomSail and fm+gt reconstruction
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/c5cf8de752ca63028856e0f408a01f14dbb5750e/docs/NCP_reconstruction.html" target="_blank">c5cf8de</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/2b97ae38d2cd26413b1a712a8c90a49293a928b8/analysis/NCP_reconstruction.Rmd" target="_blank">2b97ae3</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
added gas flux to reconstructed iCT
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/4dd0f4f7a104f03b69354203efd4c3ae7f8ce8c0/docs/NCP_reconstruction.html" target="_blank">4dd0f4f</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/f7f098369f99d493fd68258d57643284ace4dbb0/analysis/NCP_reconstruction.Rmd" target="_blank">f7f0983</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
added gas flux to reconstructed iCT
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/1b366c46b269ae7ffac97ec7c8a9bbf39c8dfd61/docs/NCP_reconstruction.html" target="_blank">1b366c4</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/eef261ff43c3b4907417f336df6f7aee4a2dc165/analysis/NCP_reconstruction.Rmd" target="_blank">eef261f</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-25
</td>
<td>
TPD CPD appendix plots
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/9166c1d1cec54c95b40e0379a83d7ac357dda80d/docs/NCP_reconstruction.html" target="_blank">9166c1d</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-20
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/ef996405125132e45a9bcc71fbc90c40c1acdbdc/analysis/NCP_reconstruction.Rmd" target="_blank">ef99640</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-20
</td>
<td>
finalized reconstruction approach
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/1e158374dfe6f37c60f2f5ee35c718c925542594/docs/NCP_reconstruction.html" target="_blank">1e15837</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-20
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/2378108a87af3fb64e4fb4013e9561f3bdd7a095/analysis/NCP_reconstruction.Rmd" target="_blank">2378108</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-20
</td>
<td>
finalized iCT reconstruction
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/6aad8d79d2a45cb0d269a7f2ddfa93b9e851bc0c/docs/NCP_reconstruction.html" target="_blank">6aad8d7</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/d7aa2272d6311075c2e9c8eca283f050258dd47b/analysis/NCP_reconstruction.Rmd" target="_blank">d7aa227</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
finalized integration depth estimates
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/ae5779d806208377d5d9416c28f6a421cd9bdd2e/docs/NCP_reconstruction.html" target="_blank">ae5779d</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/5651fe5586a5574b90becf2aabb25d51eb7b7d77/analysis/NCP_reconstruction.Rmd" target="_blank">5651fe5</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
removed deep warming signal for z_pen determination
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/6e3d8997f9504ec00aa1586e5e0d024a96c051d0/docs/NCP_reconstruction.html" target="_blank">6e3d899</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/0ba33ec8de552bc6e02de58e37a904138a3f85b1/analysis/NCP_reconstruction.Rmd" target="_blank">0ba33ec</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
cleaned NCP reconstruction IV
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/7f4066edc099d4f2d427945d2d986ff24755265f/docs/NCP_reconstruction.html" target="_blank">7f4066e</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/536cb1a9d58785b6b1087aea26ac3f0f3800076e/analysis/NCP_reconstruction.Rmd" target="_blank">536cb1a</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
cleaned NCP reconstruction III
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/dd7e745e5d40f8ac46dcaa072815756be8394114/docs/NCP_reconstruction.html" target="_blank">dd7e745</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/33c4313c020d241ae55301dafa0e37cdd7ef8e9c/analysis/NCP_reconstruction.Rmd" target="_blank">33c4313</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
cleaned NCP reconstruction II
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/57b5f60bb4a6a1ec2e758d4b8ed4466cc13f567e/docs/NCP_reconstruction.html" target="_blank">57b5f60</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/fa8ce006980d7a4ec35ffa0720cab3f4265f83d3/analysis/NCP_reconstruction.Rmd" target="_blank">fa8ce00</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-19
</td>
<td>
cleaned NCP reconstruction
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/jens-daniel-mueller/BloomSail/6fcea7b07aea3ae6b84e2b39253ddfa6537bd54d/docs/NCP_reconstruction.html" target="_blank">6fcea7b</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-18
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/jens-daniel-mueller/BloomSail/blob/09ccf10225e16a3aab9c8e0dd7159fec12cfd38c/analysis/NCP_reconstruction.Rmd" target="_blank">09ccf10</a>
</td>
<td>
jens-daniel-mueller
</td>
<td>
2020-05-18
</td>
<td>
merged tm and gt NCP reconstruction
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<pre class="r"><code>library(tidyverse)
library(ncdf4)
library(seacarb)
library(oce)
library(patchwork)
library(lubridate)
library(metR)</code></pre>
<div id="scope-of-this-script" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Scope of this script</h1>
<p>In order to test how well the depth-integrated C<sub>T</sub>* estimates can be reproduced if only surface CO<sub>2</sub> data were available, the following reconstruction approaches were tested:</p>
<ul>
<li>Mixed layer depth: Integration of surface observation across the MLD, assuming homogeneous vertical patterns</li>
<li>C<sub>T</sub> profile reconstruction: Vertical reconstruction of incremental C<sub>T</sub> changes based on profiles of incremental changes in temperature</li>
<li>Temperature penetration depth: Integration of surface observation across the temperature penetration depth, assuming similar vertical extension as for C<sub>T</sub> drawdown.</li>
</ul>
<p>Note: The reconstruction of C<sub>T</sub>* profiles and the integration across the temperature penetration depth should produce very similar results. However, the latter avoids to create misinterpretable information about the vertical distribution of C<sub>T</sub>*.</p>
<p>The integration depth parameterizations were tested on two data sets, namely:</p>
<ul>
<li>BloomSail observations, restricted to C<sub>T</sub>* data in surface water</li>
<li>SOOP Finnmaid pCO<sub>2</sub> + vertical hydrographical data from GETM model</li>
</ul>
<pre class="r"><code>date_CT_min &lt;- ymd_hms(&quot;2018-07-24 07:58:29&quot;)
date_tem_max &lt;- ymd_hms(&quot;2018-08-04 00:00:00&quot;)</code></pre>
</div>
<div id="bloomsail" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> BloomSail</h1>
<p>1m gridded, downcast profiles were used.</p>
<p>Mean CO<sub>2</sub> data from upper 6 meters were used as surface values.</p>
<pre class="r"><code># read data
tm_profiles_ID &lt;-
  read_csv(
    here::here(
      &quot;data/intermediate/_merged_data_files/NCP_best_guess&quot;,
      &quot;tm_profiles_ID.csv&quot;
    )
  )

tm_profiles_ID &lt;- tm_profiles_ID %&gt;% 
  select(-c(date_ID))

# calculate cumulative changes

tm_profiles_ID_long &lt;- tm_profiles_ID %&gt;%
  select(-c(pCO2, sal)) %&gt;% 
  pivot_longer(c(&quot;tem&quot;, &quot;CT_star&quot;), values_to = &quot;value&quot;, names_to = &quot;var&quot;) %&gt;% 
  group_by(var, dep) %&gt;%
  arrange(date_time_ID) %&gt;%
  mutate(date_time_ID_diff = as.numeric(date_time_ID - lag(date_time_ID)),
         value_diff = value     - lag(value, default = first(value)),
         value_diff_daily = value_diff / date_time_ID_diff,
         value_cum = cumsum(value_diff)) %&gt;% 
  ungroup()</code></pre>
<div id="tpd-and-cpd" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> TPD and CPD</h2>
<p>Temperature penetration depth (TPD) and C<sub>T</sub>* penetration depth (CPD) were investigated based on the BloomSail data.</p>
<div id="cumulative-profile-july-9" class="section level3" number="2.1.1">
<h3 number="2.1.1"><span class="header-section-number">2.1.1</span> Cumulative profile July 9</h3>
<pre class="r"><code># subset date for cumulative assesment
tm_profiles_ID_long_day &lt;- tm_profiles_ID_long %&gt;%
  filter(ID == 180709)

# calculate integrated value of pos/neg changes for Temp/CT*
# and relative contribution with increasing water depth 
tm_profiles_ID_long_day_dep &lt;- tm_profiles_ID_long_day %&gt;%
  select(var, dep, value_cum) %&gt;%
  mutate(
    value_cum = if_else(value_cum &gt; 0 &amp; var == &quot;CT_star&quot;,
                        NaN, value_cum),
    value_cum = if_else(value_cum &lt; 0 &amp; var == &quot;tem&quot;,
                        NaN, value_cum)
  ) %&gt;%
  group_by(var) %&gt;%
  arrange(dep) %&gt;%
  mutate(
    value_cum_i = sum(value_cum, na.rm = TRUE),
    value_cum_dep = cumsum(value_cum),
    value_cum_i_rel = value_cum_dep / value_cum_i * 100
  ) %&gt;%
  ungroup()

# cumulative integrated values
value_cum &lt;- tm_profiles_ID_long_day_dep %&gt;%
  group_by(var) %&gt;%
  summarise(value_cum_i = mean(value_cum_i)) %&gt;%
  ungroup()

# cumulative surface values
value_surface &lt;- tm_profiles_ID_long_day %&gt;%
  select(var, dep, value_cum) %&gt;%
  filter(dep &lt; parameters$surface_dep) %&gt;%
  group_by(var) %&gt;%
  summarise(value_surface = mean(value_cum)) %&gt;%
  ungroup()

# calculate penentration depth for T and C
PD &lt;- full_join(value_cum, value_surface)
PD &lt;- PD %&gt;%
  mutate(PD = value_cum_i / value_surface)

rm(value_cum, value_surface)</code></pre>
<pre class="r"><code>p_tm_profiles_ID_long &lt;- tm_profiles_ID_long_day %&gt;%
  arrange(dep) %&gt;%
  ggplot(aes(value_cum, dep)) +
  geom_hline(aes(yintercept = parameters$i_dep_lim, col = &quot;integration&quot;)) +
  geom_hline(data = PD, aes(yintercept = PD, col = &quot;penetration&quot;)) +
  geom_vline(xintercept = 0) +
  geom_point() +
  geom_path() +
  scale_y_reverse() +
  scale_color_brewer(palette = &quot;Dark2&quot;, guide = FALSE) +
  labs(y = &quot;Depth (m)&quot;, x = &quot;Cumulative change&quot;) +
  theme(legend.position = &quot;left&quot;) +
  facet_wrap(var ~ ., ncol = 1, scales = &quot;free_x&quot;)

p_tm_profiles_ID_long_rel &lt;- tm_profiles_ID_long_day_dep %&gt;%
  ggplot(aes(value_cum_i_rel, dep)) +
  geom_hline(aes(yintercept = parameters$i_dep_lim, col = &quot;integration&quot;)) +
  geom_hline(data = PD, aes(yintercept = PD, col = &quot;penetration&quot;)) +
  geom_vline(xintercept = 90) +
  geom_point() +
  geom_line() +
  scale_y_reverse(limits = c(25, 0)) +
  scale_color_brewer(palette = &quot;Dark2&quot;, name = &quot;Depth&quot;) +
  scale_x_continuous(limits = c(0, NA)) +
  labs(x = &quot;Relative contribution (%)&quot;) +
  facet_wrap(var ~ ., ncol = 1, scales = &quot;free_x&quot;) +
  theme(axis.title.y = element_blank())

p_tm_profiles_ID_long + p_tm_profiles_ID_long_rel</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/PD_cumulative_tm_profiles-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>PD</code></pre>
<pre><code># A tibble: 2 x 4
  var     value_cum_i value_surface    PD
  &lt;chr&gt;         &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;
1 CT_star      -286.         -28.5  10.1 
2 tem            16.3          1.65  9.90</code></pre>
<pre class="r"><code>rm(tm_profiles_ID_long_day_dep,
   p_tm_profiles_ID_long,
   p_tm_profiles_ID_long_rel)</code></pre>
</div>
<div id="incremental-profile-july-9" class="section level3" number="2.1.2">
<h3 number="2.1.2"><span class="header-section-number">2.1.2</span> Incremental profile July 9</h3>
<pre class="r"><code>col_value &lt;- &quot;red&quot;

p_CT_star &lt;-
  tm_profiles_ID_long_day %&gt;%
  filter(var == &quot;CT_star&quot;) %&gt;%
  arrange(dep) %&gt;%
  ggplot() +
  geom_col(
    data = tm_profiles_ID_long_day %&gt;%
      filter(var == &quot;CT_star&quot;, value_diff_daily &lt; 0),
    aes(x = value_diff_daily, y = dep),
    width = 1,
    alpha = 0.2,
    orientation = &quot;y&quot;
  ) +
  geom_vline(xintercept = 0) +
  scale_y_reverse(expand = c(0, 0)) +
  annotate(
    &quot;text&quot;,
    x = -6,
    y = 11,
    label = &quot;CPD&quot;,
    col = col_value,
    size = geom_text_size
  ) +
  annotate(
    &quot;text&quot;,
    x = -3.5,
    y = 2.5,
    label = &quot;Integrated\nchange&quot;,
    size = geom_text_size
  ) +
  geom_point(aes(value_diff_daily, dep)) +
  geom_path(aes(value_diff_daily, dep)) +
  geom_hline(data = PD %&gt;% filter(var == &quot;CT_star&quot;),
             aes(yintercept = PD),
             col = col_value) +
  labs(y = &quot;Depth (m)&quot;, x = expression(paste(Delta ~ C[T], &quot;*&quot;) ~ (µmol ~ kg ^ {
    -1
  }))) +
  theme(
    legend.title = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.title.y = element_blank()
  )

p_tem &lt;-
  tm_profiles_ID_long_day %&gt;%
  filter(var == &quot;tem&quot;) %&gt;%
  arrange(dep) %&gt;%
  ggplot() +
  geom_col(
    data = tm_profiles_ID_long_day %&gt;%
      filter(var == &quot;tem&quot;, value_diff_daily &gt; 0),
    aes(x = value_diff_daily, y = dep),
    width = 1,
    alpha = 0.2,
    orientation = &quot;y&quot;
  ) +
  geom_vline(xintercept = 0) +
  scale_y_reverse(expand = c(0, 0)) +
  annotate(
    &quot;text&quot;,
    x = 0.4,
    y = 11,
    label = &quot;PD&quot;,
    col = col_value,
    size = geom_text_size
  ) +
  annotate(
    &quot;text&quot;,
    x = 0.2,
    y = 2.5,
    label = &quot;Integrated\nchange&quot;,
    size = geom_text_size
  ) +
  geom_point(aes(value_diff_daily, dep)) +
  geom_path(aes(value_diff_daily, dep)) +
  geom_hline(data = PD %&gt;% filter(var == &quot;tem&quot;),
             aes(yintercept = PD),
             col = col_value) +
  labs(y = &quot;Depth (m)&quot;, x = expression(Delta ~ Temperature ~ (degree * C))) +
  theme(legend.title = element_blank())

p_tem + p_CT_star +
  plot_layout(guides = &#39;collect&#39;) +
  plot_annotation(tag_levels = &#39;a&#39;)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/PD_CPD_cumulative_tm_profiles_example-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggsave(
  here::here(&quot;output/Plots/Figures_publication/appendix&quot;,
             &quot;Fig_C4.pdf&quot;),
  width = 120,
  height = 110,
  dpi = 300,
  units = &quot;mm&quot;
)

ggsave(
  here::here(&quot;output/Plots/Figures_publication/appendix&quot;,
             &quot;Fig_C4.png&quot;),
  width = 120,
  height = 110,
  dpi = 300,
  units = &quot;mm&quot;
)

rm(PD, tm_profiles_ID_long_day, p_tem, p_CT_star, col_value)</code></pre>
</div>
<div id="incremental-time-series" class="section level3" number="2.1.3">
<h3 number="2.1.3"><span class="header-section-number">2.1.3</span> Incremental time series</h3>
<p>A time series of TPD and CPD was calculated, based on the incremental (ie from cruise day to cruise day) changes of temperature / C<sub>T</sub>*, taking only pos. / neg. changes of both parameters into account.</p>
<pre class="r"><code># surface values
diff_surface &lt;- tm_profiles_ID_long %&gt;%
  filter(dep &lt; parameters$surface_dep) %&gt;%
  group_by(ID, var) %&gt;%
  summarise(value_diff_surface = mean(value_diff, na.rm = TRUE)) %&gt;%
  ungroup() %&gt;%
  mutate(
    value_diff_surface = if_else(value_diff_surface &gt; 0 &amp; var == &quot;CT_star&quot;,
                                 NaN, value_diff_surface),
    value_diff_surface = if_else(value_diff_surface &lt; 0 &amp;
                                   var == &quot;tem&quot;,
                                 NaN, value_diff_surface)
  )

tm_profiles_ID_long &lt;- full_join(tm_profiles_ID_long, diff_surface)
rm(diff_surface)

# calculate penetration depths for T and C
PD &lt;- tm_profiles_ID_long %&gt;%
  mutate(
    value_diff = if_else(value_diff &gt; 0 &amp; var == &quot;CT_star&quot;,
                         NaN, value_diff),
    value_diff = if_else(value_diff &lt; 0 &amp; var == &quot;tem&quot;,
                         NaN, value_diff)
  ) %&gt;%
  group_by(var, ID, date_time_ID) %&gt;%
  summarise(
    value_diff_int = sum(value_diff, na.rm = TRUE),
    value_diff_surface = mean(value_diff_surface, na.rm = TRUE)
  ) %&gt;%
  ungroup() %&gt;%
  mutate(i_dep = value_diff_int / value_diff_surface)

# calculate temporal mean
PD_mean &lt;- PD %&gt;%
  group_by(var) %&gt;%
  summarise(i_dep_mean = mean(i_dep, na.rm = TRUE),
            i_dep_sd = sd(i_dep, na.rm = TRUE)) %&gt;%
  ungroup()</code></pre>
<pre class="r"><code>p_surface &lt;- PD %&gt;%
  ggplot(aes(date_time_ID, value_diff_surface)) +
  geom_hline(yintercept = 0) +
  geom_line() +
  geom_point() +
  scale_y_reverse(name = &quot;Change surface value&quot;) +
  scale_x_datetime(breaks = &quot;week&quot;, date_labels = &quot;%d %b&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;, direction = -1) +
  theme(axis.title.x = element_blank(),
        legend.title = element_blank()) +
  facet_grid(var ~ ., scales = &quot;free_y&quot;)

p_integrated &lt;- PD %&gt;%
  ggplot(aes(date_time_ID, value_diff_int)) +
  geom_hline(yintercept = 0) +
  geom_line() +
  geom_point() +
  scale_y_reverse(name = &quot;Change integrated value&quot;) +
  scale_x_datetime(breaks = &quot;week&quot;, date_labels = &quot;%d %b&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;, direction = -1) +
  theme(axis.title.x = element_blank(),
        legend.title = element_blank()) +
  facet_grid(var ~ ., scales = &quot;free_y&quot;)

p_pen_dep &lt;- PD %&gt;%
  ggplot(aes(date_time_ID, i_dep, col = var)) +
  geom_hline(yintercept = 0) +
  geom_hline(data = PD_mean,
             aes(
               yintercept = i_dep_mean,
               col = var,
               linetype = &quot;mean&quot;
             )) +
  geom_line(aes(linetype = &quot;cruise&quot;)) +
  geom_point() +
  scale_y_reverse(name = &quot;Penetration depth (m)&quot;, breaks = seq(0, 20, 5)) +
  scale_x_datetime(breaks = &quot;week&quot;, date_labels = &quot;%d %b&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;, direction = -1) +
  theme(axis.title.x = element_blank(),
        legend.title = element_blank())


p_surface + p_integrated + p_pen_dep +
  plot_layout(ncol = 1)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/PD_daily_tm_time_series-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>PD_mean</code></pre>
<pre><code># A tibble: 2 x 3
  var     i_dep_mean i_dep_sd
  &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;
1 CT_star       10.3     1.03
2 tem           11.5     2.46</code></pre>
<pre class="r"><code>rm(p_surface, p_integrated, p_pen_dep)
rm(PD, PD_mean, tm_profiles_ID_long)</code></pre>
</div>
</div>
</div>
<div id="getm-model" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> GETM model</h1>
<div id="read-netcdf-file" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Read netcdf file</h2>
<pre class="r"><code># read netcdf file
nc &lt;- 
  nc_open(here::here(&quot;data/input/GETM&quot;, &quot;Finnmaid.E.3d.2018.nc&quot;))

# extract latitude vector
lat &lt;- ncvar_get(nc, &quot;latc&quot;)

# extract start time
time_start &lt;- nc$dim$time$units %&gt;%
  substr(start = 15, stop = 33) %&gt;%
  ymd_hms()

# create time vecotr
t &lt;- time_start + ncvar_get(nc, &quot;time&quot;)
rm(time_start)

# extract depths vector
d &lt;- ncvar_get(nc, &quot;zax&quot;)

# read model data
for (var_3d in c(&quot;salt&quot;, &quot;temp&quot;)) {
  
  # store the data in a 3-dimensional array
  array &lt;-
    ncvar_get(nc, var_3d) 
  
  # find NA value
  fillvalue &lt;- ncatt_get(nc, var_3d, &quot;_FillValue&quot;)
  
  # replace NA value with NA
  array[array == fillvalue$value] &lt;- NA
  
  for (i in seq(1, length(t), 1)) {
    # i &lt;- 3
    array_slice &lt;- array[, , i] # slices data from one day
    
    # convert to tibble
    array_slice_df &lt;- as.data.frame(t(array_slice))
    array_slice_df &lt;- as_tibble(array_slice_df)
    
    # rename, format and subset data
    gt_3d_part &lt;- array_slice_df %&gt;%
      set_names(as.character(lat)) %&gt;%
      mutate(dep = -d) %&gt;%
      gather(&quot;lat&quot;, &quot;value&quot;, 1:length(lat)) %&gt;%
      mutate(lat = as.numeric(lat)) %&gt;%
      filter(
        lat &gt; parameters$getm_low_lat,
        lat &lt; parameters$getm_high_lat,
        dep &lt;= parameters$max_dep
      ) %&gt;%
      mutate(var = var_3d,
             date_time = t[i]) %&gt;%
      select(date_time, dep, value, var)
    
    
    if (exists(&quot;gt_3d&quot;)) {
      gt_3d &lt;- bind_rows(gt_3d, gt_3d_part)
    } else {
      gt_3d &lt;- gt_3d_part
    }
    
    rm(array_slice, array_slice_df, gt_3d_part)
    
  }
  rm(array, fillvalue)
  
}

nc_close(nc)
rm(nc)

# subset time period
# calculate daily, regional mean profile in study area
gt_3d_long &lt;- gt_3d %&gt;%
  filter(date_time &gt;= parameters$getm_start_date &amp;
           date_time &lt;= parameters$getm_end_date) %&gt;%
  group_by(date_time, var, dep) %&gt;%
  summarise_all(list(value =  ~ mean(., na.rm = TRUE))) %&gt;% # regional averaging
  ungroup()

gt_3d &lt;- gt_3d_long %&gt;%
  pivot_wider(values_from = value, names_from = var) %&gt;%
  rename(sal = salt, tem = temp)


rm(i, lat, d, t, var_3d)</code></pre>
</div>
<div id="sal-and-tem-profiles" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Sal and tem profiles</h2>
<pre class="r"><code>gt_3d_long %&gt;%
  ggplot(aes(value, dep,
             col = date_time,
             group = date_time)) +
  geom_path() +
  scale_y_reverse(expand = c(0, 0)) +
  scale_color_viridis_c(name = &quot;Date&quot;, trans = &quot;time&quot;) +
  facet_wrap( ~ var, scales = &quot;free_x&quot;, ncol = 2)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/gt_profiles_sal_tem-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rm(gt_3d_long)</code></pre>
</div>
<div id="comparison-bloomsail" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Comparison BloomSail</h2>
<p>Vertical, 1m-gridded BloomSail CTD profiles were used for comparison with GETM results. Note that the sampling location does not match exactly.</p>
<div id="interpolate-getm-to-bloomsail" class="section level3" number="3.3.1">
<h3 number="3.3.1"><span class="header-section-number">3.3.1</span> Interpolate GETM to BloomSail</h3>
<p>GETM results were linearly interpolated to the BloomSail depth levels and the mean cruise dates.</p>
<pre class="r"><code>gt_3d_int &lt;- gt_3d %&gt;%
  mutate(dep_int = dep + 0.5) %&gt;%
  group_by(date_time) %&gt;%
  mutate(sal_int = approxfun(dep, sal)(dep_int),
         tem_int = approxfun(dep, tem)(dep_int)) %&gt;%
  ungroup() %&gt;%
  select(date_time,
         dep = dep_int,
         sal = sal_int,
         tem = tem_int) %&gt;%
  drop_na()

rm(gt_3d)</code></pre>
<pre class="r"><code># join GETM and BloomSail profiles
tm_gt_3d &lt;- full_join(
  gt_3d_int,
  tm_profiles_ID %&gt;% select(date_time = date_time_ID,
                            dep, sal, tem),
  by = c(&quot;date_time&quot;, &quot;dep&quot;),
  suffix = c(&quot;_gt&quot;, &quot;_tm&quot;)
)

# calculate density profiles
tm_gt_3d &lt;- tm_gt_3d  %&gt;%
  mutate(
    rho_gt = swSigma(
      salinity = sal_gt,
      temperature = tem_gt,
      pressure = dep / 10
    ),
    rho_tm = swSigma(
      salinity = sal_tm,
      temperature = tem_tm,
      pressure = dep / 10
    )
  )

# interpolate to BloomSail time stamp
tm_gt_3d &lt;- tm_gt_3d %&gt;%
  arrange(date_time) %&gt;%
  group_by(dep) %&gt;%
  mutate(
    tem_gt = approxfun(date_time, tem_gt)(date_time),
    sal_gt = approxfun(date_time, sal_gt)(date_time),
    rho_gt = approxfun(date_time, rho_gt)(date_time)
  ) %&gt;%
  ungroup() %&gt;%
  drop_na()</code></pre>
</div>
<div id="s-t-rho-profiles" class="section level3" number="3.3.2">
<h3 number="3.3.2"><span class="header-section-number">3.3.2</span> S, T, rho profiles</h3>
<pre class="r"><code># convert to long format
tm_gt_3d_long &lt;- tm_gt_3d %&gt;%
  pivot_longer(
    sal_gt:rho_tm,
    values_to = &quot;value&quot;,
    names_to = c(&quot;var&quot;, &quot;source&quot;),
    names_sep = &quot;_&quot;
  )

tm_gt_3d_long %&gt;%
  ggplot(aes(value, dep,
             col = date_time,
             group = date_time)) +
  geom_path() +
  scale_y_reverse(expand = c(0, 0), name = &quot;Depth (m)&quot;) +
  scale_color_viridis_c(name = &quot;Date&quot;, trans = &quot;time&quot;) +
  facet_grid(source ~ var, scales = &quot;free_x&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="figure/NCP_reconstruction.Rmd/gt_ts_profiles_salt_temp_rho-1.png" alt="STD profiles modeled with GETM (upper panels, gt) and measured during BloomSail campaign (lower panels, ts)" width="672" />
<p class="caption">
STD profiles modeled with GETM (upper panels, gt) and measured during BloomSail campaign (lower panels, ts)
</p>
</div>
</div>
<div id="s-t-rho-offset-profiles" class="section level3" number="3.3.3">
<h3 number="3.3.3"><span class="header-section-number">3.3.3</span> S, T, rho offset profiles</h3>
<pre class="r"><code>tm_gt_3d &lt;- tm_gt_3d_long %&gt;%
  pivot_wider(values_from = &quot;value&quot;, names_from = &quot;source&quot;) %&gt;%
  mutate(value_diff = gt - tm)

tm_gt_3d %&gt;%
  ggplot(aes(value_diff, dep,
             col = date_time,
             group = date_time)) +
  geom_vline(xintercept = 0, col = &quot;red&quot;) +
  geom_path() +
  scale_y_reverse(expand = c(0, 0), name = &quot;Depth (m)&quot;) +
  scale_color_viridis_c(name = &quot;Date&quot;, trans = &quot;time&quot;) +
  facet_grid(. ~ var, scales = &quot;free_x&quot;) +
  labs(x = &quot;Difference GETM (gt) - Bloomsail (ts)&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="figure/NCP_reconstruction.Rmd/gt_ts_profiles_diff_salt_temp_rho-1.png" alt="Offset STD profiles comparing modeled with GETM (upper panels, gt) and measured during BloomSail campaign (lower panels, ts)" width="672" />
<p class="caption">
Offset STD profiles comparing modeled with GETM (upper panels, gt) and measured during BloomSail campaign (lower panels, ts)
</p>
</div>
<pre class="r"><code>rm(tm_gt_3d, tm_gt_3d_long)</code></pre>
</div>
</div>
</div>
<div id="soop-finnmaid" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> SOOP Finnmaid</h1>
<div id="data-preparation" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Data preparation</h2>
<pre class="r"><code>fm &lt;-
 read_csv(here::here(&quot;data/intermediate/_summarized_data_files&quot;,
                      &quot;fm_bloomsail.csv&quot;))

fm &lt;- fm %&gt;% 
  filter(date_time &gt; parameters$getm_start_date,
         date_time &lt; parameters$getm_end_date) %&gt;% 
  select(ID, date_time, sensor, sal, tem, pCO2) %&gt;% 
  mutate(ID = as.factor(ID))</code></pre>
<div id="ct-calculation" class="section level3" number="4.1.1">
<h3 number="4.1.1"><span class="header-section-number">4.1.1</span> C<sub>T</sub>* calculation</h3>
<p>Calculate C<sub>T</sub>* based on fixed A<sub>T</sub> and salinity mean values.</p>
<pre class="r"><code># read mean bottle data
fixed_values &lt;- 
  read_csv(here::here(&quot;data/intermediate/_summarized_data_files&quot;, &quot;tb_fix.csv&quot;))

# calculate CT*
fm &lt;- fm %&gt;%
  mutate(
    CT_star = carb(
      24,
      var1 = pCO2,
      var2 = fixed_values$AT * 1e-6,
      S = fixed_values$sal,
      T = tem,
      k1k2 = &quot;m10&quot;,
      kf = &quot;dg&quot;,
      ks = &quot;d&quot;,
      gas = &quot;insitu&quot;
    )[, 16] * 1e6
  )</code></pre>
</div>
<div id="regional-averaging" class="section level3" number="4.1.2">
<h3 number="4.1.2"><span class="header-section-number">4.1.2</span> Regional averaging</h3>
<p>Calculate regional mean and sd values for each crossing of the area.</p>
<pre class="r"><code>fm_ID &lt;- fm %&gt;%
  pivot_longer(c(pCO2, sal, tem, CT_star),
               values_to = &quot;value&quot;,
               names_to = &quot;var&quot;) %&gt;%
  group_by(ID) %&gt;%
  mutate(date_time_ID = mean(date_time)) %&gt;%
  ungroup() %&gt;%
  select(-date_time) %&gt;%
  group_by(ID, date_time_ID, sensor, var) %&gt;%
  summarise_all(list( ~ mean(.), ~ sd(.)), na.rm = TRUE) %&gt;%
  ungroup() %&gt;%
  rename(value = mean)</code></pre>
</div>
<div id="read-tm-profile-data" class="section level3" number="4.1.3">
<h3 number="4.1.3"><span class="header-section-number">4.1.3</span> Read tm profile data</h3>
<p>Read original profile data and calculate surface mean and sd values.</p>
<pre class="r"><code>tm_profiles &lt;-
  read_csv(
    here::here(
      &quot;data/intermediate/_merged_data_files/NCP_best_guess&quot;,
      &quot;tm_profiles.csv&quot;
    )
  )

# surface mean calculation
tm_profiles_ID_long_surface &lt;- tm_profiles %&gt;%
  filter(dep &lt; parameters$surface_dep) %&gt;%
  select(-c(dep, date_ID, station, date_time, lat, lon, pCO2_corr)) %&gt;%
  mutate(ID = as.factor(ID)) %&gt;%
  pivot_longer(sal:CT_star, values_to = &quot;value&quot;, names_to = &quot;var&quot;) %&gt;%
  group_by(ID, date_time_ID, var) %&gt;%
  summarise_all(list( ~ mean(.), ~ sd(.)), na.rm = TRUE) %&gt;%
  ungroup()</code></pre>
</div>
<div id="timeseries" class="section level3" number="4.1.4">
<h3 number="4.1.4"><span class="header-section-number">4.1.4</span> Timeseries</h3>
<pre class="r"><code>fm_ID %&gt;%
  ggplot() +
  geom_rect(data = fixed_values,
            aes(
              xmin = start,
              xmax = end,
              ymin = -Inf,
              ymax = Inf
            ),
            alpha = 0.2) +
  geom_path(aes(x = date_time_ID, y = value)) +
  geom_ribbon(aes(
    x = date_time_ID,
    y = value,
    ymax = value + sd,
    ymin = value - sd,
    fill = &quot;Finnmaid&quot;
  ),
  alpha = 0.3) +
  geom_ribbon(
    data = tm_profiles_ID_long_surface,
    aes(
      x = date_time_ID,
      ymin = mean - sd,
      ymax = mean + sd,
      fill = &quot;BloomSail&quot;
    ),
    alpha = 0.3
  ) +
  geom_point(aes(x = date_time_ID, y = value, col = sensor)) +
  geom_point(data = tm_profiles_ID_long_surface,
             aes(x = date_time_ID, y = mean, col = &quot;BloomSail&quot;)) +
  geom_line(data = tm_profiles_ID_long_surface,
            aes(x = date_time_ID, y = mean, col = &quot;BloomSail&quot;)) +
  facet_grid(var ~ ., scales = &quot;free_y&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;) +
  scale_fill_brewer(palette = &quot;Set1&quot;, name = &quot;+/- SD&quot;) +
  scale_x_datetime(date_breaks = &quot;week&quot;,
                   date_labels = &quot;%b %d&quot;) +
  theme(axis.title.x = element_blank())</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/fm_tm_time_series-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="missing-observations" class="section level3" number="4.1.5">
<h3 number="4.1.5"><span class="header-section-number">4.1.5</span> Missing observations</h3>
<p>The observational gaps in the Finnmaid SST and C<sub>T</sub>* time series were filled with:</p>
<ul>
<li>two BloomSail observations</li>
<li>an interpolated Finnmaid value to match the starting date</li>
</ul>
<p>The time series was restricted to the period where BloomSail observations are available.</p>
<pre class="r"><code># create data frame with start dates
tm_start_date &lt;- tm_profiles_ID_long_surface %&gt;% 
  filter(ID %in% c(&quot;180705&quot;),
         var %in% c(&quot;tem&quot;, &quot;CT_star&quot;)) %&gt;% 
  select(date_time_ID, ID, var) %&gt;% 
  mutate(sensor = &quot;interpolated&quot;)

# add start dates to Finnmaid data
fm_tm_ID &lt;- full_join(fm_ID, tm_start_date) %&gt;% 
  arrange(date_time_ID) %&gt;% 
  filter(var %in% c(&quot;tem&quot;, &quot;CT_star&quot;))

# interpolate Finnmaid to BloomSail start date
fm_tm_ID &lt;- fm_tm_ID %&gt;% 
  group_by(var) %&gt;% 
  mutate(value = approxfun(date_time_ID, value)(date_time_ID)) %&gt;% 
  ungroup()

rm(tm_start_date)</code></pre>
<pre class="r"><code># subset BloomSail data in Finnmaid gap
tm_gap &lt;- tm_profiles_ID_long_surface %&gt;%
  filter(ID %in% c(&quot;180718&quot;, &quot;180723&quot;),
         var %in% c(&quot;tem&quot;, &quot;CT_star&quot;)) %&gt;%
  select(date_time_ID, ID, var, value = mean) %&gt;%
  mutate(sensor = &quot;BloomSail&quot;)

# add data to fill Finnmaid gap
fm_tm_ID &lt;- full_join(fm_tm_ID, tm_gap) %&gt;%
  arrange(date_time_ID) %&gt;%
  select(-sd) %&gt;%
  filter(var %in% c(&quot;tem&quot;, &quot;CT_star&quot;)) %&gt;%
  mutate(
    period = &quot;BloomSail&quot;,
    period = if_else(date_time_ID &lt; fixed_values$start, &quot;pre-BloomSail&quot;, period),
    period = if_else(date_time_ID &gt; fixed_values$end, &quot;post-BloomSail&quot;, period)
  )

# filter only Finnmaid data within BloomSail period
fm_tm_ID &lt;- fm_tm_ID %&gt;%
  filter(period == &quot;BloomSail&quot;) %&gt;%
  select(-period)

rm(fm_ID, fm, tm_gap, tm_profiles_ID_long_surface, tm_profiles, fixed_values)</code></pre>
</div>
<div id="final-time-series" class="section level3" number="4.1.6">
<h3 number="4.1.6"><span class="header-section-number">4.1.6</span> Final time series</h3>
<pre class="r"><code>fm_tm_ID %&gt;%
  ggplot() +
  geom_path(aes(date_time_ID, value)) +
  geom_point(aes(date_time_ID, value, col = sensor)) +
  facet_grid(var ~ ., scales = &quot;free_y&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;) +
  scale_x_datetime(date_breaks = &quot;week&quot;,
                   date_labels = &quot;%b %d&quot;) +
  theme(axis.title.x = element_blank())</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/fm_time_series_filled-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="merge-all-data-sets" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Merge all data sets</h1>
<div id="merge-fm-and-gt" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> Merge fm and gt</h2>
<pre class="r"><code># convert to wide format
fm_tm_ID_wide &lt;- fm_tm_ID %&gt;%
  filter(var %in% c(&quot;CT_star&quot;)) %&gt;%
  select(date_time_ID, var, sensor, value) %&gt;%
  pivot_wider(values_from = value, names_from = var)

# extend surface data with depth grid
fm_gt &lt;- expand_grid(fm_tm_ID_wide, dep = unique(gt_3d_int$dep))

# join Finnmaid and GETM data
fm_gt &lt;- full_join(fm_gt,
                   gt_3d_int %&gt;% rename(date_time_ID = date_time)) %&gt;%
  arrange(date_time_ID)

rm(fm_tm_ID_wide, fm_tm_ID, gt_3d_int)</code></pre>
</div>
<div id="interpolate-gt-time-stamp-to-fm" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Interpolate gt time stamp to fm</h2>
<p>GETM data are interpolated to the time of Finnmaid observations.</p>
<pre class="r"><code>fm_gt &lt;- fm_gt %&gt;%
  arrange(date_time_ID) %&gt;%
  group_by(dep) %&gt;%
  mutate(
    tem = approxfun(date_time_ID, tem)(date_time_ID),
    sal = approxfun(date_time_ID, sal)(date_time_ID)
  ) %&gt;%
  ungroup() %&gt;%
  arrange(dep) %&gt;%
  filter(!is.na(CT_star))</code></pre>
</div>
<div id="bind-tm-and-fm_gt" class="section level2" number="5.3">
<h2 number="5.3"><span class="header-section-number">5.3</span> Bind tm and fm_gt</h2>
<p>Here, we merge the in-situ sensor data from SV Tina V with the Finnmaid+GETM data set, in order to perform following computations only once.</p>
<pre class="r"><code># subset relevant columns and assign source label
tm_profiles_ID &lt;- tm_profiles_ID %&gt;%
  select(-c(ID, pCO2)) %&gt;%
  mutate(source = &quot;tm&quot;,
         sensor = &quot;BloomSail&quot;)

fm_gt &lt;- fm_gt %&gt;%
  mutate(source = &quot;fm&quot;)

# Merge data sets
tm_fm_gt &lt;- bind_rows(tm_profiles_ID, fm_gt)

rm(fm_gt, tm_profiles_ID)</code></pre>
</div>
<div id="comparison" class="section level2" number="5.4">
<h2 number="5.4"><span class="header-section-number">5.4</span> Comparison</h2>
<div id="surface-time-series" class="section level3" number="5.4.1">
<h3 number="5.4.1"><span class="header-section-number">5.4.1</span> Surface time series</h3>
<pre class="r"><code># convert to long format
tm_fm_gt_long &lt;- tm_fm_gt %&gt;%
  pivot_longer(sal:CT_star, values_to = &quot;value&quot;, names_to = &quot;var&quot;)

tm_fm_gt_long %&gt;%
  filter(dep == 3.5) %&gt;%
  ggplot(aes(date_time_ID, value, col = source)) +
  geom_path() +
  geom_point() +
  scale_x_datetime(date_breaks = &quot;week&quot;,
                   date_labels = &quot;%b %d&quot;) +
  facet_grid(var ~ ., scales = &quot;free_y&quot;) +
  labs(title = &quot;Time series at 3.5 m&quot;) +
  theme(axis.title.x = element_blank())</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/tm_fm_gt_time_series-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="hovmoeller-temperature" class="section level3" number="5.4.2">
<h3 number="5.4.2"><span class="header-section-number">5.4.2</span> Hovmoeller temperature</h3>
<pre class="r"><code>bin &lt;- 2

tm_fm_gt %&gt;%
  ggplot(aes(date_time_ID, dep, z = tem)) +
  geom_contour_fill(breaks = MakeBreaks(bin)) +
  geom_vline(aes(xintercept = date_time_ID),
             col = &quot;white&quot;,
             linetype = &quot;1f&quot;) +
  scale_fill_viridis_c(
    name = &quot;tem&quot;,
    option = &quot;B&quot;,
    guide = &quot;colorstrip&quot;,
    breaks = MakeBreaks(bin)
  ) +
  scale_y_reverse() +
  scale_x_datetime(date_breaks = &quot;week&quot;,
                   date_labels = &quot;%b %d&quot;) +
  coord_cartesian(expand = 0) +
  theme(axis.title.x = element_blank()) +
  facet_grid(source ~ .)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/tm_fm_gt_hovmoeller_tem-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rm(bin)</code></pre>
</div>
</div>
</div>
<div id="integration-depths" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Integration depths</h1>
<div id="mld" class="section level2" number="6.1">
<h2 number="6.1"><span class="header-section-number">6.1</span> MLD</h2>
<div id="density-calculation" class="section level3" number="6.1.1">
<h3 number="6.1.1"><span class="header-section-number">6.1.1</span> Density calculation</h3>
<pre class="r"><code>tm_fm_gt &lt;- tm_fm_gt %&gt;%
  mutate(rho = swSigma(
    salinity = sal,
    temperature = tem,
    pressure = dep / 10
  ))</code></pre>
</div>
<div id="hovmoeller-density" class="section level3" number="6.1.2">
<h3 number="6.1.2"><span class="header-section-number">6.1.2</span> Hovmoeller density</h3>
<pre class="r"><code>bin &lt;- 0.5

tm_fm_gt %&gt;%
  ggplot() +
  geom_contour_fill(aes(date_time_ID, dep, z = rho),
                    breaks = MakeBreaks(bin)) +
  geom_vline(aes(xintercept = date_time_ID),
             col = &quot;white&quot;,
             linetype = &quot;1f&quot;) +
  scale_fill_viridis_c(
    name = &quot;rho&quot;,
    option = &quot;B&quot;,
    guide = &quot;colorstrip&quot;,
    breaks = MakeBreaks(bin),
    direction = -1
  ) +
  scale_y_reverse() +
  scale_x_datetime(date_breaks = &quot;week&quot;,
                   date_labels = &quot;%b %d&quot;) +
  coord_cartesian(expand = 0) +
  theme(axis.title.x = element_blank()) +
  facet_grid(source ~ .)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/tm_fm_gt_hovmoeller_rho-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rm(bin)</code></pre>
</div>
<div id="mld-calculation" class="section level3" number="6.1.3">
<h3 number="6.1.3"><span class="header-section-number">6.1.3</span> MLD calculation</h3>
<pre class="r"><code>tm_fm_gt_MLD &lt;- expand_grid(tm_fm_gt, rho_lim = parameters$rho_lim_integration_depths)

tm_fm_gt_MLD &lt;- tm_fm_gt_MLD %&gt;%
  arrange(dep) %&gt;%
  group_by(date_time_ID, source, rho_lim) %&gt;%
  mutate(d_rho = rho - first(rho)) %&gt;%
  filter(d_rho &gt; rho_lim) %&gt;%
  summarise(MLD = min(dep)) %&gt;%
  ungroup() %&gt;%
  mutate(rho_lim = as.factor(rho_lim))</code></pre>
</div>
<div id="hovmoeller-mld" class="section level3" number="6.1.4">
<h3 number="6.1.4"><span class="header-section-number">6.1.4</span> Hovmoeller MLD</h3>
<pre class="r"><code>bin &lt;- 2

tm_fm_gt %&gt;%
  ggplot() +
  geom_contour_fill(aes(date_time_ID, dep, z = tem),
                    breaks = MakeBreaks(bin)) +
  geom_path(data = tm_fm_gt_MLD, aes(date_time_ID, MLD, col = rho_lim)) +
  scale_fill_gradient(
    name = &quot;Tem (°C)&quot;,
    guide = &quot;colorstrip&quot;,
    breaks = MakeBreaks(bin),
    high = &quot;grey80&quot;,
    low = &quot;grey5&quot;
  ) +
  scale_color_viridis_d() +
  scale_y_reverse() +
  scale_x_datetime(date_breaks = &quot;week&quot;,
                   date_labels = &quot;%b %d&quot;) +
  coord_cartesian(expand = 0) +
  labs(y = &quot;Depth (m)&quot;) +
  theme(axis.title.x = element_blank()) +
  facet_grid(source ~ .)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/tm_fm_gt_hovmoeller_tem_MLD-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rm(bin)</code></pre>
</div>
<div id="select-rho-criterion" class="section level3" number="6.1.5">
<h3 number="6.1.5"><span class="header-section-number">6.1.5</span> Select rho criterion</h3>
<pre class="r"><code>MLD &lt;- tm_fm_gt_MLD %&gt;%
  filter(rho_lim == parameters$rho_lim) %&gt;%
  select(-rho_lim) %&gt;%
  rename(i_dep = MLD) %&gt;%
  mutate(i_method = &quot;MLD&quot;, i_res = &quot;daily&quot;)

rm(tm_fm_gt_MLD)</code></pre>
</div>
<div id="mean-mld" class="section level3" number="6.1.6">
<h3 number="6.1.6"><span class="header-section-number">6.1.6</span> Mean MLD</h3>
<pre class="r"><code># Filter data before temperature peak, and calculate mean
MLD_mean &lt;- MLD %&gt;%
  filter(date_time_ID &lt;= date_tem_max) %&gt;%
  group_by(source) %&gt;%
  summarise(MLD_mean = mean(i_dep, na.rm = TRUE),
            MLD_sd = sd(i_dep, na.rm = TRUE)) %&gt;%
  ungroup()

MLD_mean</code></pre>
<pre><code># A tibble: 2 x 3
  source MLD_mean MLD_sd
  &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
1 fm          5.5   1.18
2 tm          6     1.87</code></pre>
<pre class="r"><code># format mean MLD data frame
MLD_mean &lt;- MLD_mean %&gt;%
  select(-MLD_sd) %&gt;% 
  rename(i_dep = MLD_mean) %&gt;%
  mutate(i_method = &quot;MLD&quot;, i_res = &quot;mean&quot;)

MLD_dates &lt;- MLD %&gt;%
  select(source, date_time_ID)

MLD_mean &lt;- full_join(MLD_dates, MLD_mean)
MLD &lt;- full_join(MLD, MLD_mean)

rm(MLD_mean)</code></pre>
</div>
</div>
<div id="tpd" class="section level2" number="6.2">
<h2 number="6.2"><span class="header-section-number">6.2</span> TPD</h2>
<div id="cumulative-changes" class="section level3" number="6.2.1">
<h3 number="6.2.1"><span class="header-section-number">6.2.1</span> Cumulative changes</h3>
<pre class="r"><code>tm_fm_gt_long &lt;- tm_fm_gt %&gt;%
  select(-c(sal)) %&gt;%
  pivot_longer(c(&quot;tem&quot;, &quot;CT_star&quot;),
               values_to = &quot;value&quot;,
               names_to = &quot;var&quot;) %&gt;%
  group_by(source, var, dep) %&gt;%
  arrange(date_time_ID) %&gt;%
  mutate(
    date_time_ID_diff = as.numeric(date_time_ID - lag(date_time_ID)),
    value_diff = value - lag(value, default = first(value)),
    value_diff_daily = value_diff / date_time_ID_diff,
    value_cum = cumsum(value_diff)
  ) %&gt;%
  ungroup()

# select only temperature data
tm_fm_gt_long &lt;- tm_fm_gt_long %&gt;%
  filter(var == &quot;tem&quot;) %&gt;%
  select(-var)</code></pre>
</div>
<div id="temperature-profiles" class="section level3" number="6.2.2">
<h3 number="6.2.2"><span class="header-section-number">6.2.2</span> Temperature profiles</h3>
<p>Please note that the cumulative temperature profile of GETM shows a deep maximum below 20m, which must be attributed to water mass exchange rather than surface warming to radiation or heat uptake, which we want to capture here. Therefore, the integration depth of the GETM data was manually restricted to 19m.</p>
<pre class="r"><code>tm_fm_gt_long %&gt;%
  filter(date_time_ID == date_CT_min) %&gt;%
  arrange(dep) %&gt;%
  ggplot(aes(value_cum, dep)) +
  geom_vline(xintercept = 0) +
  geom_hline(yintercept = parameters$getm_i_dep) +
  geom_point() +
  geom_path() +
  scale_y_reverse() +
  labs(x = &quot;Cumulative tem change&quot;,
       title = as.Date(date_CT_min)) +
  theme(legend.position = &quot;left&quot;) +
  facet_grid(. ~ source, scales = &quot;free_x&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="figure/NCP_reconstruction.Rmd/cumulative_tem_profile-1.png" alt="Profiles of cumulative temperature changes from the GETM model (label fm) and as measured in the field (label tm)." width="672" />
<p class="caption">
Profiles of cumulative temperature changes from the GETM model (label fm) and as measured in the field (label tm).
</p>
</div>
</div>
<div id="cumulative-tpd" class="section level3" number="6.2.3">
<h3 number="6.2.3"><span class="header-section-number">6.2.3</span> Cumulative TPD</h3>
<pre class="r"><code># subset data at CT* minimum
tm_fm_gt_long_day &lt;- tm_fm_gt_long %&gt;%
  filter(date_time_ID == date_CT_min) %&gt;%
  mutate(
    value_cum = if_else(value_cum &lt; 0,
                        NaN, value_cum),
    value_cum = if_else(source == &quot;fm&quot; &amp;
                          dep &gt; parameters$getm_i_dep,
                        NaN, value_cum)
  )

# integrate cumulative changes
tm_fm_gt_long_day_dep &lt;- tm_fm_gt_long_day %&gt;%
  select(source, dep, value_cum) %&gt;%
  group_by(source) %&gt;%
  arrange(dep) %&gt;%
  mutate(
    value_cum_i = sum(value_cum, na.rm = TRUE),
    value_cum_dep = cumsum(value_cum),
    value_cum_i_rel = value_cum_dep / value_cum_i * 100
  ) %&gt;%
  ungroup()

# extract integrated cumulative value
value_cum &lt;- tm_fm_gt_long_day_dep %&gt;%
  group_by(source) %&gt;%
  summarise(value_cum_i = mean(value_cum_i)) %&gt;%
  ungroup()

# extract surface cumulative value
value_surface &lt;- tm_fm_gt_long_day %&gt;%
  select(source, dep, value_cum) %&gt;%
  filter(dep &lt; parameters$surface_dep) %&gt;%
  group_by(source) %&gt;%
  summarise(value_surface = mean(value_cum)) %&gt;%
  ungroup()

# calculate TPD
TPD &lt;- full_join(value_cum, value_surface)
TPD &lt;- TPD %&gt;%
  mutate(i_dep = value_cum_i / value_surface)

rm(value_cum, value_surface)</code></pre>
<pre class="r"><code>p_tm_fm_gt_long &lt;- tm_fm_gt_long_day %&gt;%
  arrange(dep) %&gt;%
  ggplot(aes(value_cum, dep)) +
  geom_hline(aes(yintercept = parameters$i_dep_lim, col = &quot;fixed\nintegration\ndepth&quot;)) +
  geom_hline(data = TPD, aes(yintercept = i_dep, col = &quot;TPD\nestimate&quot;)) +
  geom_vline(xintercept = 0) +
  geom_point() +
  geom_path() +
  scale_y_reverse() +
  scale_color_brewer(palette = &quot;Dark2&quot;, guide = FALSE) +
  labs(x = &quot;Cumulative change&quot;) +
  theme(legend.position = &quot;left&quot;) +
  facet_wrap(. ~ source, ncol = 1, scales = &quot;free_x&quot;)

p_tm_fm_gt_long_rel &lt;- tm_fm_gt_long_day_dep %&gt;%
  ggplot(aes(value_cum_i_rel, dep)) +
  geom_hline(aes(yintercept = parameters$i_dep_lim, col = &quot;fixed\nintegration\ndepth&quot;)) +
  geom_hline(data = TPD, aes(yintercept = i_dep, col = &quot;TPD\nestimate&quot;)) +
  geom_vline(xintercept = 90) +
  geom_point() +
  geom_line() +
  scale_y_reverse(limits = c(25, 0)) +
  scale_color_brewer(palette = &quot;Dark2&quot;, name = &quot;&quot;) +
  scale_x_continuous(limits = c(0, NA)) +
  labs(x = &quot;Relative contribution (%)&quot;) +
  facet_wrap(. ~ source, ncol = 1, scales = &quot;free_x&quot;) +
  theme(axis.title.y = element_blank())

p_tm_fm_gt_long + p_tm_fm_gt_long_rel</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/TPD_cumulative_profiles_180723-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rm(
  tm_fm_gt_long_day,
  tm_fm_gt_long_day_dep,
  p_tm_fm_gt_long,
  p_tm_fm_gt_long_rel
)

TPD_cum &lt;- TPD

rm(TPD)</code></pre>
</div>
<div id="incremental-tpd" class="section level3" number="6.2.4">
<h3 number="6.2.4"><span class="header-section-number">6.2.4</span> Incremental TPD</h3>
<pre class="r"><code># incremental changes of surface values
diff_surface &lt;- tm_fm_gt_long %&gt;%
  filter(dep &lt; parameters$surface_dep) %&gt;%
  group_by(date_time_ID, source) %&gt;%
  summarise(value_diff_surface = mean(value_diff, na.rm = TRUE)) %&gt;%
  ungroup() %&gt;%
  mutate(value_diff_surface = if_else(value_diff_surface &lt; 0,
                                      NaN, value_diff_surface))

tm_fm_gt_long &lt;- full_join(tm_fm_gt_long, diff_surface)
rm(diff_surface)

# calculate penetration depths
TPD &lt;- tm_fm_gt_long %&gt;%
  mutate(
    value_diff = if_else(value_diff &lt; 0,
                         NaN, value_diff),
    value_diff = if_else(source == &quot;fm&quot; &amp; dep &gt; 19,
                         NaN, value_diff)
  ) %&gt;%
  group_by(date_time_ID, source) %&gt;%
  summarise(
    value_diff_int = sum(value_diff, na.rm = TRUE),
    value_diff_surface = mean(value_diff_surface, na.rm = TRUE)
  ) %&gt;%
  ungroup() %&gt;%
  mutate(i_dep = value_diff_int / value_diff_surface)

# calculate mean TPD across bloom period
TPD_mean &lt;- TPD %&gt;%
  filter(date_time_ID &lt;= date_CT_min) %&gt;%
  group_by(source) %&gt;%
  summarise(i_dep_sd = sd(i_dep, na.rm = TRUE),
            i_dep = mean(i_dep, na.rm = TRUE)) %&gt;%
  ungroup()

p_surface &lt;- TPD %&gt;%
  ggplot(aes(date_time_ID, value_diff_surface, col = source)) +
  geom_hline(yintercept = 0) +
  geom_line() +
  geom_point() +
  scale_y_reverse(name = &quot;Change surface value&quot;) +
  scale_x_datetime(breaks = &quot;week&quot;, date_labels = &quot;%d %b&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;, direction = -1) +
  theme(axis.title.x = element_blank(),
        legend.title = element_blank())

p_integrated &lt;- TPD %&gt;%
  ggplot(aes(date_time_ID, value_diff_int, col = source)) +
  geom_hline(yintercept = 0) +
  geom_line() +
  geom_point() +
  scale_y_reverse(name = &quot;Change integrated value&quot;) +
  scale_x_datetime(breaks = &quot;week&quot;, date_labels = &quot;%d %b&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;, direction = -1) +
  theme(axis.title.x = element_blank(),
        legend.title = element_blank())

p_TPD &lt;- TPD %&gt;%
  ggplot(aes(date_time_ID, i_dep, col = source)) +
  geom_hline(yintercept = 0) +
  geom_hline(data = TPD_mean,
             aes(
               yintercept = i_dep,
               col = source,
               linetype = &quot;mean&quot;
             )) +
  geom_line(aes(linetype = &quot;cruise&quot;)) +
  geom_point() +
  scale_y_reverse(name = &quot;Penetration depth (m)&quot;, breaks = seq(0, 20, 5)) +
  scale_x_datetime(breaks = &quot;week&quot;, date_labels = &quot;%d %b&quot;) +
  scale_color_brewer(palette = &quot;Set1&quot;, direction = -1) +
  theme(axis.title.x = element_blank(),
        legend.title = element_blank())


p_surface + p_integrated + p_TPD +
  plot_layout(ncol = 1)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/incremental_TPD-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>TPD_mean</code></pre>
<pre><code># A tibble: 2 x 3
  source i_dep_sd i_dep
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 fm         2.31  11.4
2 tm         2.46  12.3</code></pre>
<pre class="r"><code>rm(p_surface, p_integrated, p_TPD)</code></pre>
</div>
<div id="join-tpd-estimates" class="section level3" number="6.2.5">
<h3 number="6.2.5"><span class="header-section-number">6.2.5</span> Join TPD estimates</h3>
<pre class="r"><code>TPD &lt;- TPD %&gt;%
  select(date_time_ID, source, i_dep) %&gt;%
  mutate(i_method = &quot;TPD&quot;, i_res = &quot;daily&quot;) %&gt;%
  filter(date_time_ID &lt; date_tem_max) %&gt;%
  mutate(i_dep = if_else(is.na(i_dep), 0, i_dep))

TPD_cum &lt;- TPD_cum %&gt;%
  select(source, i_dep) %&gt;%
  mutate(i_method = &quot;TPD&quot;, i_res = &quot;cumulative&quot;)

TPD_cum &lt;- full_join(MLD_dates, TPD_cum)

TPD_mean &lt;- TPD_mean %&gt;%
  select(source, i_dep) %&gt;%
  mutate(i_method = &quot;TPD&quot;, i_res = &quot;mean&quot;)

TPD_mean &lt;- full_join(MLD_dates, TPD_mean)

TPD &lt;- full_join(TPD, TPD_cum)
TPD &lt;- full_join(TPD, TPD_mean)

rm(TPD_cum, TPD_mean)</code></pre>
</div>
</div>
<div id="join-tpd-and-mld" class="section level2" number="6.3">
<h2 number="6.3"><span class="header-section-number">6.3</span> Join TPD and MLD</h2>
<pre class="r"><code>i_dep &lt;- full_join(MLD, TPD)
rm(MLD, TPD)</code></pre>
</div>
<div id="hovmoeller-mldtpd" class="section level2" number="6.4">
<h2 number="6.4"><span class="header-section-number">6.4</span> Hovmoeller + MLD/TPD</h2>
<pre class="r"><code>bin &lt;- 2

# prepare data sets
i_dep &lt;- i_dep %&gt;%
  mutate(source = factor(source, c(&quot;tm&quot;, &quot;fm&quot;))) %&gt;%
  mutate(source = fct_recode(
    source,
    `SOOP Finnmaid + GETM model` = &quot;fm&quot;,
    `SV Tina V (surface only)` = &quot;tm&quot;
  ))

tm_fm_gt &lt;- tm_fm_gt %&gt;%
  mutate(source = factor(source, c(&quot;tm&quot;, &quot;fm&quot;))) %&gt;%
  mutate(source = fct_recode(
    source,
    `SOOP Finnmaid + GETM model` = &quot;fm&quot;,
    `SV Tina V (surface only)` = &quot;tm&quot;
  ))

p_hov_dep &lt;-
  tm_fm_gt %&gt;%
  ggplot() +
  geom_contour_fill(aes(date_time_ID, dep, z = tem),
                    breaks = MakeBreaks(bin),
                    col = &quot;black&quot;,
                    size = 0.1) +
  geom_path(data = i_dep %&gt;% filter(i_res == &quot;daily&quot; &amp; i_dep != 0),
            aes(date_time_ID, i_dep, col = i_method)) +
  scale_fill_gradient(
    name = &quot;Temperature\n(\u00B0C)&quot;,
    guide = &quot;colorstrip&quot;,
    breaks = MakeBreaks(bin),
    high = &quot;grey90&quot;,
    low = &quot;grey20&quot;
  ) +
  guides(fill = guide_colorsteps(barheight = unit(35, &quot;mm&quot;),
                                 barwidth = unit(4, &quot;mm&quot;),
                                 frame.colour = &quot;black&quot;,
                                 ticks = TRUE,
                                 ticks.colour = &quot;black&quot;)) +
  scale_color_discrete(name = &quot;Reconstruction&quot;, guide = FALSE) +
  scale_y_reverse() +
  scale_x_datetime(date_breaks = &quot;week&quot;,
                   date_labels = &quot;%b %d&quot;,
                   sec.axis = dup_axis()) +
  coord_cartesian(expand = 0) +
  labs(y = expression(atop(Depth, (m)))) +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    axis.text.x.top = element_blank(),
    plot.margin = margin(0, 0, 0, 0, &quot;cm&quot;)
  ) +
  facet_wrap( ~ source)

p_hov_dep</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/tm_fm_gt_hovmoeller_tem_MLD_TPD-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rm(bin)</code></pre>
</div>
</div>
<div id="surface-data-integr.-depth" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Surface data + integr. depth</h1>
<p>Here, we restrict all C<sub>T</sub>* observations to surface waters, and merge with the integrations depth estimates.</p>
<pre class="r"><code># calculate surface water time series
tm_fm_gt_surface &lt;- tm_fm_gt %&gt;%
  filter(dep &lt; parameters$surface_dep) %&gt;%
  select(source, date_time_ID, sensor, CT_star) %&gt;%
  group_by(source, date_time_ID, sensor) %&gt;%
  summarise(CT_star = mean(CT_star, na.rm = TRUE)) %&gt;%
  ungroup()

# calculate incremental and cumulative changes
tm_fm_gt_surface &lt;- tm_fm_gt_surface %&gt;%
  group_by(source) %&gt;%
  arrange(date_time_ID) %&gt;%
  mutate(
    date_time_ID_diff = as.numeric(date_time_ID - lag(date_time_ID)),
    CT_star_diff = CT_star - lag(CT_star, default = first(CT_star)),
    CT_star_cum = cumsum(CT_star_diff)
  ) %&gt;%
  ungroup()</code></pre>
<pre class="r"><code>iCT &lt;- full_join(tm_fm_gt_surface, i_dep)
rm(tm_fm_gt_surface)</code></pre>
</div>
<div id="ncp-reconstruction" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> NCP reconstruction</h1>
<div id="integration-of-ct" class="section level2" number="8.1">
<h2 number="8.1"><span class="header-section-number">8.1</span> Integration of C<sub>T</sub>*</h2>
<p>Incremental depth-integrated changes of C<sub>T</sub>* are calculated as the product of incremental changes of surface C<sub>T</sub>* and the integration depth parameter.</p>
<pre class="r"><code># integrate incremental CT* changes across depth
iCT &lt;- iCT %&gt;% 
  mutate(CT_i_diff = CT_star_diff * i_dep)

# calculate cumulative changes
iCT &lt;- iCT %&gt;% 
  group_by(source, i_method, i_res) %&gt;%
  arrange(date_time_ID) %&gt;%
  mutate(CT_star_i_cum = cumsum(CT_i_diff/1000)) %&gt;% 
  ungroup()</code></pre>
</div>
<div id="read-best-guess-ncp" class="section level2" number="8.2">
<h2 number="8.2"><span class="header-section-number">8.2</span> Read best-guess NCP</h2>
<pre class="r"><code>tm_NCP_cum &lt;- read_csv(here::here(&quot;data/intermediate/_merged_data_files/NCP_best_guess&quot;,
                                  &quot;tm_NCP_cum.csv&quot;))</code></pre>
</div>
<div id="adapt-air-sea-flux" class="section level2" number="8.3">
<h2 number="8.3"><span class="header-section-number">8.3</span> Adapt air sea flux</h2>
<p>The air-sea fluxes of CO<sub>2</sub> previously calculated for the NCP best-guess were also applied to all reconstructed estimates</p>
<pre class="r"><code># prepare air sea flux data from best-guess approach
tm_NCP_cum_flux &lt;- tm_NCP_cum %&gt;%
  select(date_time, flux_cum)

tm_NCP_cum_flux &lt;-
  expand_grid(
    tm_NCP_cum_flux,
    source = unique(iCT$source),
    i_method = unique(iCT$i_method),
    i_res = unique(iCT$i_res)
  )

NCP_flux &lt;- full_join(iCT %&gt;% rename(date_time = date_time_ID),
                      tm_NCP_cum_flux) %&gt;%
  arrange(date_time)

# linear interpolation of cumulative changes to frequency of the flux estimates estimates
NCP_flux_int &lt;- NCP_flux %&gt;%
  filter(!(i_method == &quot;MLD&quot; &amp; i_res == &quot;cumulative&quot;)) %&gt;%
  group_by(source, i_method, i_res) %&gt;%
  mutate(
    CT_star_i_cum = approxfun(date_time, CT_star_i_cum)(date_time),
    flux_cum = approxfun(date_time, flux_cum)(date_time)
  ) %&gt;%
  fill(flux_cum) %&gt;%
  mutate(CT_star_i_flux_cum = CT_star_i_cum + flux_cum) %&gt;%
  ungroup()</code></pre>
</div>
<div id="time-series" class="section level2" number="8.4">
<h2 number="8.4"><span class="header-section-number">8.4</span> Time series</h2>
<div id="without-mixing-corrrection" class="section level3" number="8.4.1">
<h3 number="8.4.1"><span class="header-section-number">8.4.1</span> Without mixing corrrection</h3>
<p>Below, we compare all derived NCP reconstructions to the best-guess time series of integrated C<sub>T</sub>* changes, which were only corrected for air-sea fluxes but not for mixing.</p>
<pre class="r"><code>iCT &lt;- iCT %&gt;%
  mutate(sensor = if_else(sensor == &quot;BloomSail&quot;, sensor, &quot;VOS&quot;))

p_CT_star &lt;- iCT %&gt;%
  ggplot() +
  geom_path(aes(date_time_ID, CT_star)) +
  geom_point(aes(date_time_ID, CT_star, fill = sensor), shape = 21) +
  scale_fill_manual(values = c(&quot;white&quot;, &quot;black&quot;),
                    guide = FALSE) +
  scale_x_datetime(breaks = &quot;week&quot;,
                   date_labels = &quot;%d %b&quot;,
                   expand = c(0, 0)) +
  facet_wrap( ~ source) +
  labs(y = expression(atop(paste(C[T], &quot;*&quot;), (mu * mol ~ kg ^ {
    -1
  })))) +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    plot.margin = margin(0, 0, 0, 0, &quot;cm&quot;)
  )

p_iCT &lt;- iCT %&gt;%
  ggplot() +
  geom_hline(yintercept = 0) +
  geom_path(data = tm_NCP_cum,
            aes(date_time, CT_star_i_cum),
            col = &quot;black&quot;) +
  geom_path(aes(
    date_time_ID,
    CT_star_i_cum,
    col = i_method,
    linetype = i_res
  )) +
  scale_color_discrete(name = &quot;Reconstruction&quot;) +
  scale_x_datetime(
    breaks = &quot;week&quot;,
    date_labels = &quot;%d %b&quot;,
    sec.axis = dup_axis(),
    expand = c(0, 0)
  ) +
  scale_linetype(name = &quot;Resolution&quot;) +
  facet_wrap(~ source) +
  labs(y = expression(atop(Integrated ~ nC[T], (mol ~ m ^ {
    -2
  })))) +
  guides(color = guide_legend(order = 1)) +
  theme(
    axis.title.x = element_blank(),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    axis.text.x.top = element_blank()
  )

p_CT_star / p_hov_dep / p_iCT</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/NCP_time_series_without_mixing-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="with-mixing-corrrection" class="section level3" number="8.4.2">
<h3 number="8.4.2"><span class="header-section-number">8.4.2</span> With mixing corrrection</h3>
<p>Below, we compare four NCP reconstructions based on daily incremental integration depth estimates to the best-guess NCP time series, ie the integrated C<sub>T</sub>* changes, which were corrected for air-sea fluxes and for mixing.</p>
<pre class="r"><code>NCP_flux &lt;- NCP_flux %&gt;%
  mutate(i_res = factor(i_res, c(&quot;mean&quot;, &quot;cumulative&quot;, &quot;daily&quot;)))

p_NCP &lt;- NCP_flux_int %&gt;%
  filter(i_res %in% c(&quot;daily&quot;)) %&gt;%
  ggplot() +
  geom_hline(yintercept = 0) +
  geom_path(
    data = tm_NCP_cum,
    aes(date_time, CT_star_i_flux_mix_cum, linetype = &quot;best \U2013 guess&quot;),
    col = &quot;black&quot;
  ) +
  geom_path(aes(
    date_time,
    CT_star_i_flux_cum,
    col = i_method,
    linetype = &quot;reconstruction&quot;
  )) +
  scale_color_discrete(name = &quot;Integration depth&quot;) +
  scale_x_datetime(
    breaks = &quot;week&quot;,
    date_labels = &quot;%d %b&quot;,
    sec.axis = dup_axis(),
    expand = c(0, 0)
  ) +
  scale_linetype_manual(name = expression(- NCP~estimate),
                        values = c(2, 1)) +
  facet_wrap(~ source) +
  labs(y = expression(atop(- NCP, (mol ~ m ^ {
    -2
  })))) +
  guides(color = guide_legend(order = 1)) +
  theme(
    axis.title.x = element_blank(),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    axis.text.x.top = element_blank(),
    plot.margin = margin(0, 0, 0, 0, &quot;cm&quot;)
  )

p_CT_star / p_hov_dep / p_NCP +
  plot_annotation(tag_levels = &#39;a&#39;)</code></pre>
<p><img src="figure/NCP_reconstruction.Rmd/NCP_time_seriess_with_mixing-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggsave(
  here::here(&quot;output/Plots/Figures_publication/article&quot;,
             &quot;Fig_6.pdf&quot;),
  width = 160,
  height = 155,
  dpi = 300,
  units = &quot;mm&quot;
)

ggsave(
  here::here(&quot;output/Plots/Figures_publication/article&quot;,
             &quot;Fig_6.png&quot;),
  width = 160,
  height = 155,
  dpi = 300,
  units = &quot;mm&quot;
)</code></pre>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.0.3 (2020-10-10)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 18363)

Matrix products: default

locale:
[1] LC_COLLATE=English_Germany.1252  LC_CTYPE=English_Germany.1252   
[3] LC_MONETARY=English_Germany.1252 LC_NUMERIC=C                    
[5] LC_TIME=English_Germany.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] metR_0.9.0        lubridate_1.7.9.2 patchwork_1.1.1   seacarb_3.2.14   
 [5] oce_1.2-0         gsw_1.0-5         testthat_3.0.1    ncdf4_1.17       
 [9] forcats_0.5.0     stringr_1.4.0     dplyr_1.0.2       purrr_0.3.4      
[13] readr_1.4.0       tidyr_1.1.2       tibble_3.0.4      ggplot2_3.3.3    
[17] tidyverse_1.3.0   workflowr_1.6.2  

loaded via a namespace (and not attached):
 [1] httr_1.4.2         jsonlite_1.7.2     viridisLite_0.3.0  here_1.0.1        
 [5] modelr_0.1.8       assertthat_0.2.1   highr_0.8          cellranger_1.1.0  
 [9] yaml_2.2.1         pillar_1.4.7       backports_1.2.1    glue_1.4.2        
[13] digest_0.6.27      RColorBrewer_1.1-2 promises_1.1.1     checkmate_2.0.0   
[17] rvest_0.3.6        colorspace_2.0-0   plyr_1.8.6         htmltools_0.5.0   
[21] httpuv_1.5.4       pkgconfig_2.0.3    broom_0.7.5        haven_2.3.1       
[25] scales_1.1.1       whisker_0.4        later_1.1.0.1      git2r_0.27.1      
[29] generics_0.1.0     farver_2.0.3       ellipsis_0.3.1     withr_2.3.0       
[33] cli_2.2.0          magrittr_2.0.1     crayon_1.3.4       readxl_1.3.1      
[37] evaluate_0.14      ps_1.5.0           fs_1.5.0           fansi_0.4.1       
[41] xml2_1.3.2         tools_4.0.3        data.table_1.13.6  hms_0.5.3         
[45] lifecycle_0.2.0    munsell_0.5.0      reprex_0.3.0       isoband_0.2.3     
[49] compiler_4.0.3     rlang_0.4.10       grid_4.0.3         rstudioapi_0.13   
[53] labeling_0.4.2     rmarkdown_2.6      gtable_0.3.0       DBI_1.1.0         
[57] R6_2.5.0           knitr_1.30         utf8_1.1.4         rprojroot_2.0.2   
[61] stringi_1.5.3      Rcpp_1.0.5         vctrs_0.3.6        dbplyr_2.0.0      
[65] tidyselect_1.1.0   xfun_0.19         </code></pre>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
